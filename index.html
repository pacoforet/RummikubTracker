<!DOCTYPE html>
<html lang="es" data-theme="auto">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#121212">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="description" content="Track Rummikub game scores with ease">
  <title>Rummikub Tracker</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon.png">
</head>
<body>

  <!-- TOAST CONTAINER -->
  <div id="toast-container" aria-live="polite"></div>

  <!-- APP HEADER -->
  <header class="app-header" role="banner">
    <div id="header-title">Rummikub</div>
    <div class="header-actions">
      <!-- Shown during game -->
      <button id="chart-btn" class="icon-btn hidden" data-action="open-chart" aria-label="Score chart">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
        </svg>
      </button>
      <button id="history-btn" class="icon-btn hidden" data-action="open-history" aria-label="Game history">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 8v4l3 3m6-3a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"></path>
        </svg>
      </button>
      <!-- Shown during setup -->
      <button id="archive-btn" class="icon-btn" data-action="open-archive" aria-label="Past games">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="2" y="3" width="20" height="5" rx="1"></rect>
          <path d="M4 8v11a2 2 0 002 2h12a2 2 0 002-2V8"></path>
          <path d="M10 12h4"></path>
        </svg>
      </button>
      <button id="settings-btn" class="icon-btn" data-action="open-settings" aria-label="Settings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M12 1v2m0 18v2m-9-11h2m18 0h2m-4.22-5.78l1.42-1.42M4.22 19.78l1.42-1.42m0-12.72L4.22 4.22m15.56 15.56l-1.42-1.42"></path>
        </svg>
      </button>
    </div>
  </header>

  <main id="main-container" role="main">

    <!-- VIEW: SETUP -->
    <section id="view-setup" class="view active" aria-label="Game setup">
      <div class="card">
        <h2 id="label-config">Configuraci칩n</h2>
        <div class="input-group">
          <label id="label-target" for="target-score">Puntuaci칩n Objetivo (Opcional)</label>
          <input type="number" id="target-score" placeholder="ej. 200" pattern="\d*" inputmode="numeric">
        </div>
        <div class="input-group">
          <label id="label-scoring-rule">Regla de Puntuaci칩n</label>
          <div class="segmented-control" role="radiogroup" aria-label="Scoring rule">
            <button class="segment active" data-group="rule" data-value="standard" data-action="set-rule" role="radio" aria-checked="true">Est치ndar</button>
            <button class="segment" data-group="rule" data-value="simple" data-action="set-rule" role="radio" aria-checked="false">Simple</button>
          </div>
          <p class="helper-text" id="rule-desc">El ganador suma los puntos de los perdedores. Los perdedores restan sus puntos.</p>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2 id="label-players">Jugadores</h2>
          <span id="player-count">2/6</span>
        </div>
        <div id="player-setup-list">
          <!-- JS populates -->
        </div>
        <button class="btn btn-outline" id="add-player-btn" data-action="add-player">+ A침adir Jugador</button>
      </div>

      <button class="btn btn-outline" id="quick-start-btn" data-action="quick-start" style="display:none">Repetir 칔ltima Partida</button>
      <button class="btn btn-primary btn-large sticky-bottom" id="start-game-btn" data-action="start-game">Iniciar Partida</button>
    </section>

    <!-- VIEW: SCOREBOARD -->
    <section id="view-scoreboard" class="view" aria-label="Scoreboard">
      <div class="stats-bar">
        <div class="stat">
          <span class="label" id="round-label">RONDA</span>
          <span class="value" id="round-display">1</span>
        </div>
        <div class="stat">
          <span class="label" id="goal-label">META</span>
          <span class="value" id="goal-display">-</span>
        </div>
        <div class="stats-bar-actions">
          <button class="btn-small btn-secondary" id="sort-btn" data-action="toggle-sort">Ordenar</button>
          <button class="btn-small btn-secondary" id="undo-btn" data-action="undo-last-round">Deshacer</button>
          <button class="btn-small btn-danger" id="end-btn" data-action="end-game">Fin</button>
        </div>
      </div>

      <div id="leaderboard" class="leaderboard-grid" role="list" aria-label="Player scores">
        <!-- JS populates -->
      </div>

      <div class="fab-container">
        <button class="btn btn-primary btn-fab" id="record-round-btn" data-action="open-round-entry">
          + Registrar Ronda
        </button>
      </div>
    </section>

    <!-- MODAL: ROUND ENTRY -->
    <div id="modal-round" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="round-modal-title">Resultados de la Ronda</h3>
          <button class="close-btn" data-action="close-round" aria-label="Close">&times;</button>
        </div>
        <p class="instruction-text" id="round-instruction">Selecciona el ganador.</p>
        <div id="round-entry-list">
          <!-- JS populates -->
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary btn-large" id="save-round-btn" data-action="submit-round">Guardar Ronda</button>
        </div>
      </div>
    </div>

    <!-- MODAL: HISTORY -->
    <div id="modal-history" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="history-modal-title">Historial de la Partida</h3>
          <button class="close-btn" data-action="close-history" aria-label="Close">&times;</button>
        </div>
        <div id="history-list">
          <!-- JS populates -->
        </div>
      </div>
    </div>

    <!-- MODAL: WINNER CELEBRATION -->
    <div id="modal-winner" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modal-content winner-modal">
        <div class="confetti-container" aria-hidden="true">
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="confetti"></div>
        </div>
        <div class="winner-content">
          <div class="trophy" aria-hidden="true">游끥</div>
          <h2 class="winner-title" id="winner-title-text">춰Ganador!</h2>
          <div class="winner-name" id="winner-name">Player</div>
          <div class="winner-score-display" id="winner-score">0</div>

          <div id="game-summary-stats" class="game-summary-stats">
            <!-- JS populates -->
          </div>

          <div class="final-scores">
            <h4 id="final-scores-heading">Puntuaciones Finales</h4>
            <div id="final-scores-list">
              <!-- JS populates -->
            </div>
          </div>

          <div class="winner-actions">
            <button class="btn btn-outline" id="share-results-btn" data-action="share-results">Compartir Resultados</button>
            <button class="btn btn-primary" id="winner-new-game-btn" data-action="new-game-winner">Nueva Partida</button>
            <button class="btn btn-outline" id="winner-keep-playing-btn" data-action="keep-playing">Seguir Jugando</button>
          </div>
        </div>
      </div>
    </div>

    <!-- MODAL: CHART -->
    <div id="modal-chart" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="chart-modal-title">Gr치fico de Puntuaci칩n</h3>
          <button class="close-btn" data-action="close-chart" aria-label="Close">&times;</button>
        </div>
        <div class="chart-container">
          <canvas id="score-chart"></canvas>
        </div>
      </div>
    </div>

    <!-- MODAL: ARCHIVE -->
    <div id="modal-archive" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="archive-modal-title">Partidas Anteriores</h3>
          <button class="close-btn" data-action="close-archive" aria-label="Close">&times;</button>
        </div>
        <div id="archive-list">
          <!-- JS populates -->
        </div>
      </div>
    </div>

    <!-- MODAL: SETTINGS -->
    <div id="modal-settings" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="settings-modal-title">Ajustes</h3>
          <button class="close-btn" data-action="close-settings" aria-label="Close">&times;</button>
        </div>
        <div class="settings-group">
          <label id="label-theme">Tema</label>
          <div class="segmented-control" role="radiogroup" aria-label="Theme">
            <button class="segment" data-group="theme" data-value="dark" data-action="set-theme" role="radio">Oscuro</button>
            <button class="segment active" data-group="theme" data-value="auto" data-action="set-theme" role="radio">Auto</button>
            <button class="segment" data-group="theme" data-value="light" data-action="set-theme" role="radio">Claro</button>
          </div>
        </div>
        <div class="settings-group">
          <label id="label-language">Idioma</label>
          <div class="segmented-control" role="radiogroup" aria-label="Language">
            <button class="segment active" data-group="language" data-value="es" data-action="set-language" role="radio">Espa침ol</button>
            <button class="segment" data-group="language" data-value="en" data-action="set-language" role="radio">English</button>
          </div>
        </div>
      </div>
    </div>

    <!-- CUSTOM DIALOG (replaces alert/confirm) -->
    <div id="custom-dialog" class="modal" role="alertdialog" aria-modal="true" aria-hidden="true">
      <div class="modal-content">
        <div class="dialog-title"></div>
        <div class="dialog-message"></div>
        <div class="dialog-actions">
          <button class="btn btn-outline" data-action="dialog-cancel">Cancelar</button>
          <button class="btn btn-primary" data-action="dialog-confirm">Confirmar</button>
        </div>
      </div>
    </div>

  </main>

  <script type="module" src="js/app.js"></script>
</body>
</html>
